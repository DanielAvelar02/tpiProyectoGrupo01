{% extends 'base_menu.html' %}

{% block menu_title %}
  Pagar
{% endblock %}

{% block menu_content %}
  <style>
    main {
        padding: 40px 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        height: calc(100vh - 50px);
        background-color: #f9f9f9;
    }

    .pago-container {
        display: flex;
        gap: 40px;
        border: 1px solid #ccc;
        padding: 40px;
        border-radius: 8px;
        background-color: #fff;
        width: 80%;
        max-width: 1200px;
    }

    .mapa {
        flex: 1;
        text-align: center;
    }

    #map {
        width: 100%;
        height: 300px;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-bottom: 10px;
    }

    .formulario {
        flex: 1;
    }

    .formulario h3 {
        margin-bottom: 20px;
    }

    .formulario label {
        display: block;
        font-weight: bold;
        margin: 10px 0 5px;
    }

    .formulario input[type="text"],
    .formulario input[type="tel"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .metodo-pago {
        margin: 20px 0;
    }

    .metodo-pago label {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        gap: 10px;
    }

    .btn-info {
        background-color: #f8f8f8;
        border: 1px solid #ccc;
        padding: 5px 10px;
        font-size: 14px;
        cursor: pointer;
        border-radius: 4px;
    }

    .btn-info:hover {
        background-color: #e0e0e0;
    }

    .btn-pagar {
        display: block;
        background-color: #007BFF;
        color: #fff;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 20px;
    }

    .btn-pagar:hover {
        background-color: #0056b3;
    }
  </style>

  <main>
    <div class="pago-container">
      <!-- Mapa -->
      <div class="mapa">
        <div id="map"></div>
        <p>Selecciona tu ubicación</p>
      </div>
      <!-- Formulario -->
      <div class="formulario">
        <h3>Información</h3>
        <form id="pagoForm">
          <label for="nombre">Nombre:</label>
          <input type="text" id="nombre" name="nombre" required>

          <label for="apellido">Apellido:</label>
          <input type="text" id="apellido" name="apellido" required>

          <label for="telefono">Teléfono:</label>
          <input type="tel" id="telefono" name="telefono" required>

          <div class="metodo-pago">
            <label>
              <input type="radio" name="metodo" value="efectivo" required>
              Efectivo
            </label>
            <label>
              <input type="radio" name="metodo" value="tarjeta">
              Tarjeta <button type="button" class="btn-info">Añadir info pago</button>
            </label>
          </div>

          <button type="submit" class="btn-pagar">Pagar</button>
        </form>
      </div>
    </div>
  </main>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Inicializar el mapa centrado en San Salvador
    const map = L.map('map').setView([13.692940, -89.218191], 13); // Coordenadas de San Salvador

    // Agregar el mapa base desde OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Agregar un marcador inicial en San Salvador
    const marker = L.marker([13.692940, -89.218191], { draggable: true }).addTo(map);

    // Escuchar eventos de arrastre del marcador
    marker.on('dragend', function (e) {
        const position = marker.getLatLng();
        alert(`Ubicación seleccionada:\nLat: ${position.lat}\nLng: ${position.lng}`);
    });

    // Redirigir a la página de seguimiento del pedido al enviar el formulario
    document.getElementById('pagoForm').addEventListener('submit', function(event) {
        event.preventDefault();
        window.location.href = "{% url 'seguimiento_pedido' %}";
    });
  </script>
{% endblock %}